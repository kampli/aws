sudo dnf upgrade -y

sudo dnf info package_name


http://ec2-35-179-136-154.eu-west-2.compute.amazonaws.com/phpinfo.php


http://ec2-35-179-136-154.eu-west-2.compute.amazonaws.com/phpMyAdmin


http://my.public.dns.amazonaws.com/phpMyAdmin



mysql -u root --password="kampli00"


aws cloudformation create-stack \
  --stack-name lamp-stack \
  --template-body file://lamp-stack.yaml \
  --parameters ParameterKey=KeyName,ParameterValue=your-keypair

aws cloudformation create-stack \
  --stack-name lamp-stack \
  --template-body file://lamp-stack.json \
  --parameters ParameterKey=KeyName,ParameterValue=your-keypair



  aws cloudformation create-stack \
    --stack-name full-resilient-lamp-lambda-ssl \
    --template-body file://full-resilient-lamp-lambda-ssl.json \
    --parameters \
      ParameterKey=KeyName,ParameterValue=YOUR_KEYPAIR_NAME \
      ParameterKey=DomainName,ParameterValue=app.example.com \
      ParameterKey=HostedZoneId,ParameterValue=Z123456ABCDEFG \
    --capabilities CAPABILITY_NAMED_IAM


kampliawsadmin access key



profile kamplidev


aws configure --profile kamplidev

London
eu-west-2


export AWS_PROFILE=kamplidev
echo ${AWS_PROFILE}
aws cloudformation create-stack \
  --stack-name lamp-stack \
  --template-body file://aws_CF_LAMP_Template.yaml \
  --parameters ParameterKey=KeyName,ParameterValue=testkeypair


aws cloudformation update-stack \
  --stack-name lamp-stack \
  --template-body file://aws_CF_LAMP_Template.json \
  --parameters ParameterKey=KeyName,ParameterValue=testkeypair

aws cloudformation update-stack \
  --stack-name lamp-stack \
  --template-body file://aws_CF_LAMP_Template.yaml \
  --parameters ParameterKey=KeyName,ParameterValue=testkeypair

aws cloudformation delete-stack \
  --stack-name lamp-stack 


aws cloudformation describe-stacks \
  --stack-name lamp-stack \
  --query "Stacks[0].Outputs[?OutputKey=='InstancePublicIP'].OutputValue" \
  --output text


aws cloudformation describe-stacks \
  --stack-name lamp-stack \
  --query "Stacks[0].Outputs" \
  --output text

https://docs.aws.amazon.com/linux/al2023/ug/hosting-wordpress-aml-2023.html



aws cloudformation get-template \
  --stack-name lamp-stack \
  --region eu-west-2



aws acm import-certificate \
  --certificate fileb://kamplidev.crt \
  --private-key fileb://kamplidev.key \
  --region eu-west-2

  "CertificateArn": "arn:aws:acm:eu-west-2:725673811658:certificate/f38c66e0-e2a9-4ec3-85dc-09ee704394a9"

  http://lamp-applicationloadbalancer-668051698.eu-west-2.elb.amazonaws.com/wp-admin/install.php?step=1



  openssl req -x509 -nodes -days 365 \
    -newkey rsa:2048 \
    -keyout alb-dev.key \
    -out alb-dev.crt \
    -sha256 \
    -subj "/CN=alb.dev.local" \
    -addext "subjectAltName=DNS:alb.dev.local"

aws acm import-certificate \
  --certificate fileb://alb-dev.crt \
  --private-key fileb://alb-dev.key \
  --region eu-west-2

    "CertificateArn": "arn:aws:acm:eu-west-2:725673811658:certificate/ce0f8756-332a-49c1-ab9a-a4956ceb560b"

aws route53 list-hosted-zones \
  --query "HostedZones[?Name=='kampli.co.uk.'].Id" \
  --output text




“Refactor my template: remove DB from ASG”

“Add DB replicas + GTID replication scripts”

“ProxySQL full CloudFormation config”

“Orchestrator + ProxySQL integration hooks”

“End-to-end failover test plan”

sudo dnf install -y mariadb105


nc -vz 10.1.101.191 3306


sudo dnf install -y mariadb105
mysql -h 10.1.101.191 -u wpuser -p wpkampli00


mysql -h 10.1.101.191 -u wpuser -pwpkampli00

mysql -h 10.1.101.191 -u wpuser -pwpkampli00

mysql -h 10.1.101.191 -u wpuser --password=wpkampli00

mysql -u wpuser --password=wpkampli00

mysql -u wpuser -pwpkampli00


DBRootPassword=rootkampli00
WordPressDBName=wordpressdb
WordPressDBUser=wpuser
WordPressDBPassword=wpkampli00

mysql -u ${WordPressDBUser} -p${WordPressDBPassword}

mysql -u root -p${DBRootPassword}



php -d memory_limit=-1 composer.phar require aws/aws-sdk-php

php -d memory_limit=-1 composer-setup.php require aws/aws-sdk-php


sudo -s 
cp -f /var/www/html/index.php /var/www/html/php_bak_index.php 

cp -f /tmp/wordpress/index.php /var/www/html/wp_index.php


chown -R apache:apache /var/www/html
                find /var/www/html -type d -exec chmod 755 {} \;
                find /var/www/html -type f -exec chmod 644 {} \;

find / -name wordpress 2>/dev//null

kampli.co.uk/lambda_invoke.php

cp /tmp/wordpress/index.php /var/www/html/wp_index.php

export AWS_REGION=eu-west-2


journalctl -t cfn-init

sudo mkdir -p /etc/systemd/system/httpd.service.d
sudo tee /etc/systemd/system/httpd.service.d/aws-env.conf <<'EOF'
[Service]
Environment="AWS_REGION=eu-west-2"
Environment="AWS_DEFAULT_REGION=eu-west-2"
EOF

sudo systemctl daemon-reexec
sudo systemctl restart httpd
sudo systemctl show httpd --property=Environment



mkdir python
pip install pymysql -t python
pip install requests -t python

zip -r pymysql-layer.zip python


zip lambda_function.zip lambda_function.py



zip -r pymysql-layer.zip python
cd lambda
zip -r lambda.zip lambda_function.py
cd ..

aws cloudformation package \
    --template-file aws_CF_LAMP_Template.yaml \
    --s3-bucket lambda-artifacts-725673811658-eu-west-2 \
    --output-template-file lamp-packaged-template.yaml


aws cloudformation deploy --template-file \
    /Users/kampli/workspace/Barclays/20260105_AWS_LampServer/aws/lamp-packaged-template.yaml \
    --stack-name lamp-stack \
    --capabilities CAPABILITY_NAMED_IAM \
    --parameter-overrides KeyName=testkeypair \
                     DBRootPassword=kampli00 \
                     HostedZoneId=${HOSTZONEID}


aws s3 mb --region eu-west-2 s3://lamp-lambda-artifacts-725673811658-eu-west-2

aws s3 rm s3://lamp-lambda-artifacts-725673811658-eu-west-2/lambda.zip
aws s3 cp lambda/lambda.zip s3://lamp-lambda-artifacts-725673811658-eu-west-2/lambda.zip


aws s3 rm s3://lamp-lambda-artifacts-725673811658-eu-west-2/pymysql-layer.zip

aws s3 cp lambda/lambda.zip s3://lamp-lambda-artifacts-725673811658-eu-west-2/lambda.zip
aws s3 cp layer/pymysql-layer.zip s3://lamp-lambda-artifacts-725673811658-eu-west-2/pymysql-layer.zip


TOKEN=$(curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")


curl -H "X-aws-ec2-metadata-token: ${TOKEN}" http://169.254.169.254/latest/meta-data/placement/availability-zone


curl -H "X-aws-ec2-metadata-token: ${TOKEN}" http://169.254.169.254/latest/meta-data
